<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apostille Verification System</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/html5-qrcode@2.3.10/html5-qrcode.min.js"></script>
</head>
<body>
<header class="header">
  <div class="header-container">
    <div class="header-text">
      <h1>Legalization / Apostille Verification System</h1>
    </div>
  </div>
</header>

<main class="content">
  <form class="verification-form" id="searchForm">
    <div style="text-align:center; margin-bottom:15px;">
        <h2 style="font-size: 18px; color: #0b3d91; margin: 0;">Verify Document</h2>
        <p style="font-size: 13px; color: #666; margin: 8px 0 0;">Enter details to verify authenticity</p>
    </div>

    <label for="apostille-input">Apostille Number</label>
    <input type="text" id="apostille-input" placeholder="APO-XXXX-XXXX" required>

    <label for="date-input">Date of Issue</label>
    <input type="date" id="date-input" required>

    <label for="referral-input">Referral Code (Optional)</label>
    <input type="text" id="referral-input" placeholder="Enter code if you have one">

    <button type="submit" class="btn btn-main">Verify Document</button>

    <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button type="button" id="scan-qr-btn" class="btn btn-secondary" style="flex: 1;">
            ðŸ“· Scan QR-code
        </button>
        <a href="samples.html" class="btn btn-secondary" style="flex: 1; text-align: center; text-decoration: none;">
            View Samples
        </a>
    </div>

    <a href="dashboard.html" class="btn btn-secondary" style="margin-top: 10px; text-align: center; width: 100%; text-decoration: none;">
        Upload your Document (Login)
    </a>
  </form>
</main>

<div id="qr-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
  <div style="background:#fff; padding:20px; border-radius:8px; max-width:400px; width:90%; position:relative;">
    <button id="close-qr" style="position:absolute; right:10px; top:10px; border:none; background:none; font-size:20px; cursor:pointer;">&times;</button>
    <h3>Scan QR Code</h3>
    <div id="qr-reader" style="width:100%; margin-top:10px;"></div>
    <p id="qr-status" style="font-size:12px; color:gray; margin-top:10px;"></p>
  </div>
</div>

<script>
    // Ð›Ð¾Ð³Ð¸ÐºÐ° Ñ„Ð¾Ñ€Ð¼Ñ‹
    document.getElementById("searchForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const apostille = document.getElementById("apostille-input").value.trim();
        const date = document.getElementById("date-input").value;
        const referral = document.getElementById("referral-input").value.trim();
        
        if(apostille && date) {
            let url = `index.html?apostille=${encodeURIComponent(apostille)}&date=${encodeURIComponent(date)}`;
            if(referral) url += `&ref=${encodeURIComponent(referral)}`;
            window.location.href = url;
        }
    });

    // Ð›Ð¾Ð³Ð¸ÐºÐ° QR Ð¡ÐºÐ°Ð½ÐµÑ€Ð° (Ð¸Ð· ÐºÐ¾Ð´Ð° Ð´Ñ€ÑƒÐ³Ð°)
    const scanBtn = document.getElementById("scan-qr-btn");
    const modal = document.getElementById("qr-modal");
    const closeBtn = document.getElementById("close-qr");
    let html5QrcodeScanner = null;

    scanBtn.addEventListener("click", () => {
        modal.style.display = "flex";
        startScanner();
    });

    closeBtn.addEventListener("click", stopScanner);
    
    function startScanner() {
        html5QrcodeScanner = new Html5Qrcode("qr-reader");
        html5QrcodeScanner.start(
            { facingMode: "environment" }, 
            { fps: 10, qrbox: { width: 250, height: 250 } },
            (decodedText) => {
                // Ð£ÑÐ¿ÐµÑˆÐ½Ð¾Ðµ ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
                stopScanner();
                // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑÑÑ‹Ð»ÐºÐ° ÑÑ‚Ð¾ Ð¸Ð»Ð¸ Ñ‚ÐµÐºÑÑ‚
                if (decodedText.includes("apostille=") && decodedText.includes("date=")) {
                    // Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ ÑÑÑ‹Ð»ÐºÐ° Ð½Ð°ÑˆÐµÐ³Ð¾ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð°, Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ð¼
                    window.location.href = decodedText; 
                } else {
                    alert("QR Code format not recognized. It should contain apostille link.");
                }
            },
            (errorMessage) => {
                // ÐžÑˆÐ¸Ð±ÐºÐ¸ ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼, Ð¿Ð¾ÐºÐ° Ð¸Ñ‰ÐµÐ¼ ÐºÐ¾Ð´
            }
        ).catch(err => {
            console.error(err);
            document.getElementById("qr-status").innerText = "Camera error: " + err;
        });
    }

    function stopScanner() {
        if (html5QrcodeScanner) {
            html5QrcodeScanner.stop().then(() => {
                html5QrcodeScanner.clear();
                modal.style.display = "none";
            }).catch(err => console.error(err));
        } else {
            modal.style.display = "none";
        }
    }
</script>
</body>
</html>
